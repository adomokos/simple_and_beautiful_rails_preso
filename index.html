<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Simple and Beautiful Rails Code with Functional Style</title>
        <meta name="description" content="">
        <meta name="author" content="zied hosni, zied.hosni.mail@gmail.com">
        <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->   
        <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <!-- Le styles -->
        <link href="css/bootstrap.css" rel="stylesheet" >
        <style type="text/css">
          /* body { background: #1A1A1A; } */
          .slideshow_container { width: 550px; margin-left: auto; margin-right: auto; }
          .slideshow { padding-top: 20px; }
        </style>
        <!--[if IE 6]><script type="text/javascript" src="http://deathtoie6.com/ie6-not-supported.js" ></script><![endif]-->
    </head>
    <body>
      <div class="container slideshow_container">
          <div id="myCarousel" class="carousel slideshow">
              <!-- Carousel items -->
              <div class="carousel-inner">
                  <div class="active item">
                      <img src="img/1.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>1 - Simple and Beautiful Rails Code with Functional Style</h4>
                          <p>Hello! My name is <a href="http://www.adomokos.com" target="_blank">Attila Domokos</a> and my twitter handle is
                            <a href="https://twitter.com/adomokos" target="_blank">@adomokos</a><br>
                            This talk is a story on my search for maintainable and elegant Rails code influenced by functional thinking.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/2.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>2 - Outline</h4>
                          <p>I am not going to talk about functional programming. I am not going to try bending the Ruby language to be a functional one, either.
                             But I'll show you elegant Ruby code. So if you're ready, let's roll.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/3.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>3 - The Work You Do</h4>
                          <p>I have about 25 minutes commute to work. I listen to audio books while I drive. A friend recommended reading this book and
                             this sentence got stuck in my brain. This is how I think about it: "The kind of code you write is a reflection of who YOU ARE."</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/4.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>4 - Roads</h4>
                          <p>I am obsessed with the quality of roads. Unfortunately, in Northeast Ohio the roads are in really bad shape. You could blame it
                            on the weather, but I think the quality of work has a part to it, too. This pothole took more than a couple of weeks to grow this big.
                          </p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/5.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>5 - Pothole "Refactored"</h4>
                          <p>And when it comes to fixing it, this is what we have. Another winter and the pothole is the same size or bigger than it was.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/6.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>6 - House in the Highway</h4>
                          <p>I found this photo a couple of months ago when I was going through the news. The owner of this house refused to sell his condo to
                          the Chinese government. Since they couldn't wait building the highway, they just paved around it.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/7.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>7 - Graveyard in New Building</h4>
                          <p>I was pretty sure nothing can top the house in the highway news. I was wrong: some other people in China refused to move the 
                          remains of their relatives and since the building had to be built they just went ahead with the construction.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/8.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>8 - Hotel Room in Kyoto</h4>
                          <p>A friend of mine made a trip to Japan last year. This is one of his photos. This is a hotel room. Recognize the simplicity and 
                            pureness in this room. There is no furniture laying around.<br>
                            Steve Jobs loved Kyoto and the Japanese culture. He found inspiration in its simplicity.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/9.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>9 - Simple Code</h4>
                          <p>When you see a class like this, I'd like you to picture that hotel room in Kyoto. No extra junk, no second-guessing. Only 18 lines of
                          code and you can pretty much tell what it does.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/10.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>10 - What A Mess!</h4>
                          <p>Do you remember your room growing up? It might looked like this. How many hours did you spend looking for something? Your book, your key 
                          or your favorite t-shirt?</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/11.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>11 - Heavy Code</h4>
                          <p>And that messy room is translated into this code. This puppy is a model from one of the Rails apps we have to maintain. It has 2869 LOC.
                            The calculate_shipping has 207 lines. And the recalculate_shipping has 196 lines in it! Somebody just copied the calculate_shipping 
                            method and made a recalculate_shipping from it.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/12.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>12 - The FLOG Gem</h4>
                          <p>I wanted to find a tool that measures code complexity. The best one out there is the FLOG gem. Understanding the result is simple:
                            "The higher score the harder it is to test the code". It uses ABC metrics: assignments, branching and calls.<br>
                            I analyzed that model you saw on the previous slide: it has a total flog value of 2592!</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/13.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>13 - The Example</h4>
                          <p>I've worked on many Rails app in the last couple of years. I wanted to use an example to show you the different ideas I've tried.
                            The is a tracking app, where you can provide all the data in one text and the system parses it out into category and track records.
                            It will also check if the category already exists and will use that to file the track record.<br>
                            You can optionally provide the date in the front in case you want to use date other than today's date.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/14.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>14 - Domain Logic in Controllers</h4>
                          <p>Early on, we all put our domain logic in the controller.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/15.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>15 -  Domain Logic in Controller Action</h4>
                          <p>Using my example, I put all the parsing logic in the controller action. The action has 48 lines of code, which is not bad considering
                            what we all did a decade ago: all logic went in the views. Do you remember those good old ASP days?<br>But seriously: 48 lines of domain logic
                            in the controller?! Yeah: WTF.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/16.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>16 - Domain Logic in Controller Action - Flogged</h4>
                          <p>I am comparing the TracksController and Track model. The Track model has already some logic around displaying dynamic properties.
                          But the action has a Flog value of 46.2.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/17.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>17 - Domain Logic in Controller</h4>
                          <p>Having all logic in 1 method is bad. After extracting a couple of methods the controller is a bit easier to read, but I think this code is still
                          a mess. At least the total LOC for this action went down from 48 to 25.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/18.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>18 - Domain Logic in Controller - Flogged</h4>
                          <p>The total Flog increased slightly for the controller, but our action's complexity went down from 46.2 to 20.6.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/19.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>19 - Domain Logic in Models</h4>
                          <p>The Rails community eventually figured out that putting domain logic in the controller isn't so great. By moving the logic from the controller
                            into the models we let the controller do its work: orchestrate between views and models.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/20.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>20 - Controller Calls the Model</h4>
                          <p>After moving the parsing logic into the model the controller now has only 12 lines of code. The controller sends the message to the model,
                            the model is saved by the controller and handles the result accordingly.<br>
                            This controller code is simple and easy to understand, something I'd be happy with.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/21.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>21 - Domain Logic in Model - Flogged</h4>
                          <p>The Flog change between the controller and model clearly shows that I only moved methods around. All the parsing logic is now in the 
                          model.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/22.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>22 - Logic Outside of Rails</h4>
                          <p>This is where my story begins. After going through a couple of tutorials and placing most of the logic in models I soon started
                            breaking out of Rails and puttig domain logic in Rails-independent service objects.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/23.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>23 - Domain Logic in Service</h4>
                          <p>The controller looks very similar to the version where I had the logic in the model. Instead of calling the model, the controller
                             sends a message to the service object.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/24.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>24 - Domain Logic in Service - Flogged</h4>
                          <p>Once the logic was moved into the service, the model went back to its original size. The benefit I had with the Rails independent
                          service object was the very fast feedback loop with my unit tests.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/25.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>25 - Logic in Service Object</h4>
                          <p>This is how I initially developed my service objects. One main method was called from the controller, and that "organizer" method
                            called other methods within the same object.<br>
                            In the context of this example the controller called the "for_track" method which in turn called other methods on itself.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/26.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>26 - Testing is Easy. Or is it?</h4>
                          <p>I broke some obvious OO principles when I kept my internal methods "public" for the sake of easier testing. However, when I refactored
                             the service's internal structures, some of the unit tests broke. This did not work...</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/27.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>27 - How Will This Grow?</h4>
                          <p>I made all the methods on the service object private except the "for_track" which was called by controller. This led to increadibly
                             complex test setups. As I added more logic, the tests became even more brittle.<br>
                             Listening to my tests it became pretty clear that this will not work in the fututre.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/28.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>28 - Naming My Services</h4>
                          <p>Take a look at how I name my services. I don't use nouns, I name them with verbs. They mean actions to me. <br>When I see a class named
                            "BuildsCategory" I know exactly what this class should do. It's not for parsing the feed or the recorded at value. It forces me
                            to keep the object's single responsibility.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/29.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>29 - Execution In the Kingdom of Nouns</h4>
                          <p>I attended CodeRetreat in Cleveland right after CodeMash last year. Corey Haines mentioned <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html" target="_blank">this blog post</a> which is an amazing
                            writing. Do yourself a favor and read it! You will name your classes differently.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/30.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>30 - Players in Services</h4>
                          <p>It was obvious the design of my service object was sub-par. Testing of it was very difficult, I violated SRP all over my object. I had the find
                             a much cleaner organization of my code. Two types of objects emerged: the single organizer object and the small action objects.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/31.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>31 - Organizer Object Tells the Story</h4>
                          <p>I enjoy the kind of code that reads like a chapter from a book. I fell in love wit the readability of RSpec and the Ruby language itself.<br>
                            Most of the things we do are a series of tasks. The parsing logic I used in my example has several steps: it splits the feed to parts,
                            it parses out the recorded at date, validates the remainder of the feed, etc.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/32.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>32 - Organizer Object Dressed Up</h4>
                          <p>I wanted to preserve the readability of the tasks in the organizer object in the form of actions.. The organizer calls them in order by iterating
                          over them one by one.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/33.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>33 - The Actions</h4>
                          <p>What are the actions? They are the atomic building blocks of the domain logic workflow. The organizer object calls them in order and they
                            are unaware of each other's existance.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/34.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>34 - Once Upon a Time...</h4>
                          <p>In my Java days I really liked the <a href="http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern" target="_blank">Chain of Responsibility</a>
                            pattern that I used to brake up complex workflows into simple, single responsible actions.<br>
                          </p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/35.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>35 - Series of Actions</h4>
                          <p>Using the Chain of Responsibility made sense in a staticly typed language like Java, but it was just too much of a ceremony in Ruby.
                            Influenced by this Gof4 Pattern I came up with a slight variation of it: The Series of Actions. Instead of actions calling the next one
                            in the chain I let the organizer set up the order and call them one by one.
                          </p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/36.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>36 - An Action</h4>
                          <p>My goal was to keep the actions as simple as possible. <br>
                            Consider it as a black box: you put some stuff in it, it does it's magic and it either either alters an object already in the context or
                            adds a new one in.
                          </p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/37.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>37 - Domain Logic in Series of Actions - Flogged</h4>
                          <p>Now the total Flog value went up for the service objects after refactoring them into Series of Actions. However, and this is important,
                          the Flog class average went down significanlty. It's a lot easier to understand a class with 13 Flog value than one with around 80.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/38.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>38 - What So Functional About This?</h4>
                          <p>Well, I am not newing up objects with instance variables and other instance methods. I don't maintain state in the class object.<br>
                          I am basically building up the domain logic from small functions wrapped into class object methods.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/39.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>39 - Data is Transferred Through Context</h4>
                          <p>The actions are working on the data provided to them. The data carrier, or context is a special kind of hash. A key-value pair with
                            behavior added to it.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/40.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>40 - Context in the Organizer Object</h4>
                          <p>The organizer object initializes the Context. It passes this context to the actions when it iterates through them.<br>
                             At the very end this context object is returned to the controller filled with all data it needs.
                          </p>

                      </div>
                  </div>
                  <div class="item">
                      <img src="img/41.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>41 - Context in Actions</h4>
                          <p>The actions know how to pull data from the context. It has to have an item in order to execute the action successfully.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/42.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>42 - Error in Action</h4>
                          <p>And when an error occurs it sets the action pushed the context into a failure state.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/43.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>43 - Halting Execution</h4>
                          <p>The actions are guarding themselves against a context which is a failed state. In case the second action fails, the third
                             and fourth actions will not be executed.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/44.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>44 - Meet Light Service</h4>
                          <p>As I went from one job to the other and I used the same ideas in different Rails projects, I ended up copying files a lot.
                            Eventually I gathered all the functionalities I needed and released a gem that I named Light Service.<br>
                            The whole gem right now has only two classes. That's it. I want to keep this as "light" as possible.
                          </p>
                      </div>
                  </div>
                  <!--
                  <div class="item">
                      <img src="img/45.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>45 - Action's Execute Method</h4>
                          <p>I realized all the actions were doing the same thing.</p>
                      </div>
                  </div>
                  -->
                  <div class="item">
                      <img src="img/46.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>46 - Execute Method in Actions</h4>
                          <p>I realized all my actions were doing the same thing: guarding execution from the context in failure state and returning the 
                          context object at the very end of the method.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/47.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>47 - Executed Light Service Macro</h4>
                          <p>With <a href="https://github.com/adomokos/light-service" target="_blank">Light Service</a> you have a macro that does the same thing.
                            It creates a method for you with the name "execute", it guards the execution and returns the context. You just don't have to
                            write it for every single action. It essentially creates the method for you.
                          </p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/48.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>48 - To Get Light Service</h4>
                          <p>Either add it to your gemfile or install it through rubygems.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/49.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>49 - Growing Software</h4>
                          <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                      </div>
                  </div>
                  <!--
                  <div class="item">
                      <img src="img/50.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>50 - Thumbnail label</h4>
                          <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/51.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>51 - Thumbnail label</h4>
                          <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/52.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>52 - Thumbnail label</h4>
                          <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/53.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>53 - Thumbnail label</h4>
                          <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/54.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>54 - Thumbnail label</h4>
                          <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/55.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>55 - Summary</h4>
                          <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/56.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>56 - Social Links</h4>
                          <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/57.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>57 - Thank You</h4>
                          <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                      </div>
                  </div>
                  <div class="item">
                      <img src="img/58.jpg" alt="" />
                      <div class="carousel-caption">
                          <h4>58 - Q and A</h4>
                          <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                      </div>
                  </div>
                  -->
              </div>
              <!-- Carousel nav -->
              <a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
              <a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
         </div>
      </div>

      <script src="js/jquery.js"></script>
      <script src="js/bootstrap.js"></script>
      <script type="text/javascript">
        $(document).ready(function() {
          $('#myCarousel').carousel( {
            interval: 16000
          });
        });
      </script>
  </body>
</html>
